#!/usr/bin/env zsh
# Check UID
if [[ $UID == 0 ]]; then
	echo 'Can not create backup as root'
	return
fi

# Set backup directories
local dest src ver
	dest=/sdcard/Backup/Apps/Termux
	src=/data/data/com.termux/files
	ver=$(date +%Y%m%d)

[[ -d $dest ]] ||
	mkdir -p $dest

# Fix ownership
\fd . -u --owner=root $HOME $PREFIIX -X \
		sudo chown $USERNAME:$USERNAME

# Start backup
echo "Creating backup in $dest..."

local -a tar_opts=(
	--use-compress-program='xz --threads=0 -0'
	--warning='no-file-ignored'
	--create --file=$dest/termux_$ver.bak.tar.xz
	--directory=$src
	--exclude={.cache,'tmp/*'}
	home usr
)
tar $tar_opts

exit
